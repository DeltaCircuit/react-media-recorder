!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e||self).reactMediaRecorder={},e.react)}(this,function(e,r){var t;e.RecorderErrors=void 0,(t=e.RecorderErrors||(e.RecorderErrors={})).AbortError="media_aborted",t.NotAllowedError="permission_denied",t.NotFoundError="no_specified_media_found",t.NotReadableError="media_in_use",t.OverconstrainedError="invalid_media_constraints",t.TypeError="no_constraints",t.NONE="",t.NO_RECORDER="recorder_error";var n=function(){function e(){this.url=null,this.blob=new Blob,this.mediaChunks=[]}var r=e.prototype;return r.setBlobProperties=function(e){this.blobProperties=e},r.storeChunk=function(e){this.mediaChunks.push(e)},r.stop=function(){var e=new Blob(this.mediaChunks,this.blobProperties),r=URL.createObjectURL(e);this.blob=e,this.url=r},r.reset=function(){this.mediaChunks=[]},r.getUrl=function(){return this.url},r.getBlob=function(){return this.blob},e}();function o(t){var o=t.audio,i=void 0===o||o,u=t.video,c=void 0!==u&&u,s=t.onStop,a=void 0===s?function(){return null}:s,d=t.screen,f=void 0!==d&&d,l=t.mediaRecorderOptions,p=void 0===l?null:l,h=t.videoStorage,v=void 0===h?new n:h,m=r.useRef(null);r.useRef([]);var b=r.useRef(null),g=r.useState("idle"),R=g[0],w=g[1],E=r.useState(!1),y=E[0],M=E[1],k=r.useState(null),T=k[0],_=k[1],P=r.useState("NONE"),O=P[0],S=P[1],N=r.useCallback(function(){try{w("acquiring_media");var e={audio:"boolean"==typeof i?!!i:i,video:"boolean"==typeof c?!!c:c},r=function(r,t){try{var n=function(){function r(){w("idle")}var t=f?Promise.resolve(window.navigator.mediaDevices.getDisplayMedia({video:c||!0})).then(function(e){function r(){b.current=e}var t=function(){if(i)return Promise.resolve(window.navigator.mediaDevices.getUserMedia({audio:i})).then(function(r){r.getAudioTracks().forEach(function(r){return e.addTrack(r)})})}();return t&&t.then?t.then(r):r()}):Promise.resolve(window.navigator.mediaDevices.getUserMedia(e)).then(function(e){b.current=e});return t&&t.then?t.then(r):r()}()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}(0,function(e){S(e.name),w("idle")});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[i,c,f]);r.useEffect(function(){if(!window.MediaRecorder)throw new Error("Unsupported Browser");if(f&&!window.navigator.mediaDevices.getDisplayMedia)throw new Error("This browser doesn't support screen capturing");var e=function(e){var r=navigator.mediaDevices.getSupportedConstraints(),t=Object.keys(e).filter(function(e){return!r[e]});t.length>0&&console.error("The constraints "+t.join(",")+" doesn't support on this browser. Please check your ReactMediaRecorder component.")};"object"==typeof i&&e(i),"object"==typeof c&&e(c),p&&p.mimeType&&(MediaRecorder.isTypeSupported(p.mimeType)||console.error("The specified MIME type you supplied for MediaRecorder doesn't support this browser")),b.current||N()},[i,f,c,N,p]);var C=function(e){v.storeChunk(e.data)},U=function(){v.stop();var e=v.getUrl();w("stopped"),_(e),a(e,v.getBlob())},j=function(e){M(e),b.current&&b.current.getAudioTracks().forEach(function(r){return r.enabled=!e})};return{error:e.RecorderErrors[O],muteAudio:function(){return j(!0)},unMuteAudio:function(){return j(!1)},startRecording:function(){try{var e=function(){var e=function(){if(b.current){var e=function(){m.current=new MediaRecorder(b.current),m.current.ondataavailable=C,m.current.onstop=U,m.current.onerror=function(){S("NO_RECORDER"),w("idle")},m.current.start(),w("recording")},r=b.current.getTracks().some(function(e){return"ended"===e.readyState}),t=function(){if(r)return Promise.resolve(N()).then(function(){})}();return t&&t.then?t.then(e):e()}}();if(e&&e.then)return e.then(function(){})};S("NONE");var r=function(){if(!b.current)return Promise.resolve(N()).then(function(){})}();return Promise.resolve(r&&r.then?r.then(e):e())}catch(e){return Promise.reject(e)}},pauseRecording:function(){m.current&&"recording"===m.current.state&&m.current.pause()},resumeRecording:function(){m.current&&"paused"===m.current.state&&m.current.resume()},stopRecording:function(){m.current&&"inactive"!==m.current.state&&(w("stopping"),m.current.stop(),b.current&&b.current.getTracks().forEach(function(e){return e.stop()}),v.reset())},mediaBlobUrl:T,status:R,isAudioMuted:y,previewStream:b.current?new MediaStream(b.current.getVideoTracks()):null,clearBlobUrl:function(){return _(null)}}}e.ObjectUrlStorage=n,e.ReactMediaRecorder=function(e){return e.render(o(e))},e.useReactMediaRecorder=o});
//# sourceMappingURL=index.umd.js.map
